<!DOCTYPE html>
<html>
<head>
    <title>Files Database Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #f5f5f5; }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .header { margin-bottom: 20px; }
        .status-open { color: green; font-weight: bold; }
        .status-closed { color: red; font-weight: bold; }
        .update-indicator { 
            background-color: #4CAF50; 
            color: white; 
            padding: 5px 10px; 
            border-radius: 3px; 
            font-size: 12px; 
            margin-left: 10px; 
            display: none; 
        }
        .last-update { 
            color: #666; 
            font-size: 12px; 
            margin-top: 10px; 
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìÅ Files Database <span class="update-indicator" id="updateIndicator">üîÑ G√ºncelleniyor...</span></h1>
        <p>Total files: <span id="fileCount">{{ files|length }}</span></p>
        <p class="last-update">Son g√ºncelleme: <span id="lastUpdate">--:--:--</span></p>
    </div>
    
    <table id="filesTable">
        <thead>
            <tr>
                <th>File ID</th>
                <th>Klas√∂r</th>
                <th>Dosya No</th>
                <th>Bor√ßlu Adƒ±</th>
                <th>Alacaklƒ± Adƒ±</th>
                <th>F√∂y T√ºr√º</th>
                <th>Durum</th>
                <th>Takip Tarihi</th>
                <th>ƒ∞cra M√ºd√ºrl√ºƒü√º</th>
            </tr>
        </thead>
        <tbody id="filesTableBody">
            {% for file in files %}
            <tr>
                <td><a href="{{ url_for('file_detail', file_id=file[0]) }}">{{ file[0] }}</a></td>
                <td>{{ file[1] }}</td>
                <td>{{ file[2] }}</td>
                <td><a href="{{ url_for('borclu_files', borclu_adi=file[3]) }}">{{ file[3] }}</a></td>
                <td>{{ file[4] }}</td>
                <td>{{ file[5] }}</td>
                <td class="{% if file[6] == 'A√ßƒ±k' %}status-open{% else %}status-closed{% endif %}">{{ file[6] }}</td>
                <td>{{ file[7] }}</td>
                <td>{{ file[8] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Otomatik g√ºncelleme fonksiyonu
        function updateTable() {
            fetch('/api/files')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('filesTableBody');
                    const fileCount = document.getElementById('fileCount');
                    const updateIndicator = document.getElementById('updateIndicator');
                    const lastUpdate = document.getElementById('lastUpdate');
                    
                    // G√ºncelleme g√∂stergesini g√∂ster
                    updateIndicator.style.display = 'inline';
                    
                    // Tablo i√ßeriƒüini g√ºncelle
                    tbody.innerHTML = '';
                    data.files.forEach(file => {
                        const row = document.createElement('tr');
                        const statusClass = file.durum === 'A√ßƒ±k' ? 'status-open' : 'status-closed';
                        
                        row.innerHTML = `
                            <td><a href="/file/${file.file_id}">${file.file_id}</a></td>
                            <td>${file.klasor || ''}</td>
                            <td>${file.dosyaNo || ''}</td>
                            <td><a href="/borclu/${encodeURIComponent(file.borcluAdi)}">${file.borcluAdi || ''}</a></td>
                            <td>${file.alacakliAdi || ''}</td>
                            <td>${file.foyTuru || ''}</td>
                            <td class="${statusClass}">${file.durum || ''}</td>
                            <td>${file.takipTarihi || ''}</td>
                            <td>${file.icraMudurlugu || ''}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    // Sayƒ±larƒ± g√ºncelle
                    fileCount.textContent = data.count;
                    
                    // Son g√ºncelleme zamanƒ±nƒ± g√ºncelle
                    const now = new Date();
                    lastUpdate.textContent = now.toLocaleTimeString('tr-TR');
                    
                    // G√ºncelleme g√∂stergesini gizle
                    setTimeout(() => {
                        updateIndicator.style.display = 'none';
                    }, 1000);
                })
                .catch(error => {
                    console.error('G√ºncelleme hatasƒ±:', error);
                });
        }
        
        // Her 5 saniyede bir g√ºncelle
        setInterval(updateTable, 5000);
        
        // Sayfa y√ºklendiƒüinde ilk g√ºncellemeyi yap
        document.addEventListener('DOMContentLoaded', function() {
            // ƒ∞lk g√ºncelleme zamanƒ±nƒ± ayarla
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('tr-TR');
        });
    </script>
</body>
</html> 