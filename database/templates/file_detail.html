<!DOCTYPE html>
<html>
<head>
    <title>File Detail</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; max-width: 800px; margin-bottom: 30px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; width: 25%; }
        .header { margin-bottom: 20px; }
        .back-btn { 
            background-color: #0066cc; 
            color: white; 
            padding: 10px 20px; 
            text-decoration: none; 
            border-radius: 5px; 
            display: inline-block; 
            margin-top: 20px; 
        }
        .back-btn:hover { background-color: #0052a3; }
        .status-open { color: green; font-weight: bold; }
        .status-closed { color: red; font-weight: bold; }
        .borclu-link { color: #0066cc; text-decoration: none; }
        .borclu-link:hover { text-decoration: underline; }
        .section-title { 
            background-color: #4CAF50; 
            color: white; 
            padding: 10px; 
            margin: 20px 0 10px 0; 
            border-radius: 5px; 
        }
        .no-data { 
            background-color: #f9f9f9; 
            padding: 20px; 
            text-align: center; 
            color: #666; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
        }
        .update-indicator { 
            background-color: #4CAF50; 
            color: white; 
            padding: 5px 10px; 
            border-radius: 3px; 
            font-size: 12px; 
            margin-left: 10px; 
            display: none; 
        }
        .last-update { 
            color: #666; 
            font-size: 12px; 
            margin-top: 10px; 
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìÑ File Detail <span class="update-indicator" id="updateIndicator">üîÑ G√ºncelleniyor...</span></h1>
        <p>File ID: <span id="fileId">{{ file.file_id }}</span></p>
        <p class="last-update">Son g√ºncelleme: <span id="lastUpdate">--:--:--</span></p>
    </div>
    
    <!-- Ana Dosya Bilgileri -->
    <div class="section-title">üìã Ana Dosya Bilgileri</div>
    <table id="mainFileTable">
        <tr>
            <th>File ID</th>
            <td id="fileIdCell">{{ file.file_id }}</td>
        </tr>
        <tr>
            <th>Klas√∂r</th>
            <td id="klasorCell">{{ file.klasor }}</td>
        </tr>
        <tr>
            <th>Dosya No</th>
            <td id="dosyaNoCell">{{ file.dosyaNo }}</td>
        </tr>
        <tr>
            <th>Bor√ßlu Adƒ±</th>
            <td id="borcluAdiCell"><a href="{{ url_for('borclu_files', borclu_adi=file.borcluAdi) }}" class="borclu-link">{{ file.borcluAdi }}</a></td>
        </tr>
        <tr>
            <th>Alacaklƒ± Adƒ±</th>
            <td id="alacakliAdiCell">{{ file.alacakliAdi }}</td>
        </tr>
        <tr>
            <th>F√∂y T√ºr√º</th>
            <td id="foyTuruCell">{{ file.foyTuru }}</td>
        </tr>
        <tr>
            <th>Durum</th>
            <td id="durumCell" class="{% if file.durum == 'A√ßƒ±k' %}status-open{% else %}status-closed{% endif %}">{{ file.durum }}</td>
        </tr>
        <tr>
            <th>Takip Tarihi</th>
            <td id="takipTarihiCell">{{ file.takipTarihi }}</td>
        </tr>
        <tr>
            <th>ƒ∞cra M√ºd√ºrl√ºƒü√º</th>
            <td id="icraMudurluguCell">{{ file.icraMudurlugu }}</td>
        </tr>
    </table>

    <!-- File Details Tablosu -->
    <div class="section-title">üí∞ File Details Tablosu</div>
    <div id="fileDetailsSection">
        {% if file_details %}
        <table id="fileDetailsTable">
            <tr>
                <th>File ID</th>
                <th>Takip ≈ûekli</th>
                <th>Alacaklƒ± Vekili</th>
                <th>Bor√ß Miktarƒ±</th>
                <th>Faiz Oranƒ±</th>
                <th>G√ºncel Bor√ß</th>
                <th>Son √ñdeme</th>
            </tr>
            <tr>
                <td>{{ file_details[0] }}</td>
                <td>{{ file_details[1] }}</td>
                <td>{{ file_details[2] }}</td>
                <td>{{ file_details[3] }}</td>
                <td>{{ file_details[4] }}</td>
                <td>{{ file_details[5] }}</td>
                <td>{{ file_details[6] }}</td>
            </tr>
        </table>
        {% else %}
        <div class="no-data">Bu dosya i√ßin detay bilgisi bulunmamaktadƒ±r.</div>
        {% endif %}
    </div>

    <!-- Bor√ßlular Tablosu -->
    <div class="section-title">üë• Bor√ßlular Tablosu</div>
    <div id="borclularSection">
        {% if borclular %}
        <table id="borclularTable">
            <tr>
                <th>Bor√ßlu ID</th>
                <th>File ID</th>
                <th>Ad</th>
                <th>TC Kimlik</th>
                <th>Telefon</th>
                <th>Adres</th>
                <th>Vekil</th>
                <th>ƒ∞≈ülemler</th>
            </tr>
            {% for borclu in borclular %}
            <tr>
                <td>{{ borclu[0] }}</td>
                <td>{{ borclu[1] }}</td>
                <td>{{ borclu[2] }}</td>
                <td>{{ borclu[3] }}</td>
                <td>{{ borclu[4] }}</td>
                <td>{{ borclu[5] }}</td>
                <td>{{ borclu[6] }}</td>
                <td><a href="{{ url_for('borclu_sorgular', borclu_id=borclu[0]) }}" class="borclu-link">Sorgularƒ± G√∂r</a></td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <div class="no-data">Bu dosya i√ßin bor√ßlu bilgisi bulunmamaktadƒ±r.</div>
        {% endif %}
    </div>
    
    <a href="{{ url_for('index') }}" class="back-btn">‚Üê Back to Files</a>

    <script>
        const fileId = '{{ file.file_id }}';
        
        // Otomatik g√ºncelleme fonksiyonu
        function updateFileDetail() {
            fetch(`/api/file/${fileId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Dosya bulunamadƒ±:', data.error);
                        return;
                    }
                    
                    const updateIndicator = document.getElementById('updateIndicator');
                    const lastUpdate = document.getElementById('lastUpdate');
                    
                    // G√ºncelleme g√∂stergesini g√∂ster
                    updateIndicator.style.display = 'inline';
                    
                    // Ana dosya bilgilerini g√ºncelle
                    if (data.file) {
                        document.getElementById('fileIdCell').textContent = data.file.file_id || '';
                        document.getElementById('klasorCell').textContent = data.file.klasor || '';
                        document.getElementById('dosyaNoCell').textContent = data.file.dosyaNo || '';
                        document.getElementById('borcluAdiCell').innerHTML = `<a href="/borclu/${encodeURIComponent(data.file.borcluAdi)}" class="borclu-link">${data.file.borcluAdi || ''}</a>`;
                        document.getElementById('alacakliAdiCell').textContent = data.file.alacakliAdi || '';
                        document.getElementById('foyTuruCell').textContent = data.file.foyTuru || '';
                        
                        const durumCell = document.getElementById('durumCell');
                        durumCell.textContent = data.file.durum || '';
                        durumCell.className = data.file.durum === 'A√ßƒ±k' ? 'status-open' : 'status-closed';
                        
                        document.getElementById('takipTarihiCell').textContent = data.file.takipTarihi || '';
                        document.getElementById('icraMudurluguCell').textContent = data.file.icraMudurlugu || '';
                    }
                    
                    // File details tablosunu g√ºncelle
                    const fileDetailsSection = document.getElementById('fileDetailsSection');
                    if (data.file_details) {
                        fileDetailsSection.innerHTML = `
                            <table id="fileDetailsTable">
                                <tr>
                                    <th>File ID</th>
                                    <th>Takip ≈ûekli</th>
                                    <th>Alacaklƒ± Vekili</th>
                                    <th>Bor√ß Miktarƒ±</th>
                                    <th>Faiz Oranƒ±</th>
                                    <th>G√ºncel Bor√ß</th>
                                    <th>Son √ñdeme</th>
                                </tr>
                                <tr>
                                    <td>${data.file_details[0] || ''}</td>
                                    <td>${data.file_details[1] || ''}</td>
                                    <td>${data.file_details[2] || ''}</td>
                                    <td>${data.file_details[3] || ''}</td>
                                    <td>${data.file_details[4] || ''}</td>
                                    <td>${data.file_details[5] || ''}</td>
                                    <td>${data.file_details[6] || ''}</td>
                                </tr>
                            </table>
                        `;
                    } else {
                        fileDetailsSection.innerHTML = '<div class="no-data">Bu dosya i√ßin detay bilgisi bulunmamaktadƒ±r.</div>';
                    }
                    
                    // Bor√ßlular tablosunu g√ºncelle
                    const borclularSection = document.getElementById('borclularSection');
                    if (data.borclular && data.borclular.length > 0) {
                        let borclularHtml = `
                            <table id="borclularTable">
                                <tr>
                                    <th>Bor√ßlu ID</th>
                                    <th>File ID</th>
                                    <th>Ad</th>
                                    <th>TC Kimlik</th>
                                    <th>Telefon</th>
                                    <th>Adres</th>
                                    <th>Vekil</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                        `;
                        
                        data.borclular.forEach(borclu => {
                            borclularHtml += `
                                <tr>
                                    <td>${borclu[0] || ''}</td>
                                    <td>${borclu[1] || ''}</td>
                                    <td>${borclu[2] || ''}</td>
                                    <td>${borclu[3] || ''}</td>
                                    <td>${borclu[4] || ''}</td>
                                    <td>${borclu[5] || ''}</td>
                                    <td>${borclu[6] || ''}</td>
                                    <td><a href="/borclu_sorgular/${borclu[0]}" class="borclu-link">Sorgularƒ± G√∂r</a></td>
                                </tr>
                            `;
                        });
                        
                        borclularHtml += '</table>';
                        borclularSection.innerHTML = borclularHtml;
                    } else {
                        borclularSection.innerHTML = '<div class="no-data">Bu dosya i√ßin bor√ßlu bilgisi bulunmamaktadƒ±r.</div>';
                    }
                    
                    // Son g√ºncelleme zamanƒ±nƒ± g√ºncelle
                    const now = new Date();
                    lastUpdate.textContent = now.toLocaleTimeString('tr-TR');
                    
                    // G√ºncelleme g√∂stergesini gizle
                    setTimeout(() => {
                        updateIndicator.style.display = 'none';
                    }, 1000);
                })
                .catch(error => {
                    console.error('G√ºncelleme hatasƒ±:', error);
                });
        }
        
        // Her 5 saniyede bir g√ºncelle
        setInterval(updateFileDetail, 5000);
        
        // Sayfa y√ºklendiƒüinde ilk g√ºncelleme zamanƒ±nƒ± ayarla
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('tr-TR');
        });
    </script>
</body>
</html> 